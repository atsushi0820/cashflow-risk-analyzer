# 資金繰りリスク可視化ツール / Cash Flow Risk Analyzer

[![Python](https://img.shields.io/badge/Python-3.8+-blue.svg)](https://www.python.org/downloads/)
[![Jupyter](https://img.shields.io/badge/Jupyter-Notebook-orange.svg)](https://jupyter.org/)
[![License](https://img.shields.io/badge/License-MIT-green.svg)](LICENSE)

**中小企業の資金繰りリスクを「天気予報」のように確率で可視化するツール**

モンテカルロ法を用いて、10,000通りの売上シナリオをシミュレーションし、資金ショート確率を定量的に算出します。

---

## 🎯 このツールで何ができるか

### Phase 1: 資金ショート確率シミュレーター

- 📊 **資金繰りリスクの定量化**: 「3ヶ月以内に資金ショートする確率は15%」のように確率で表示
- 📈 **損益分岐点分析**: 売上が損益分岐点を下回る確率も同時に可視化
- 🎲 **モンテカルロ法**: 10,000通りの未来をシミュレーションして統計的に分析
- 🔍 **What-if分析**: 「固定費を20%削減したら？」などのシナリオ比較が可能

### Phase 2: ストレステスト完全版（2026年2月完成）

#### Phase 2-1: 売上急落シミュレーション
- 🔥 **コロナショック・景気後退対応**: 突発的な売上減少に対する耐性評価
- 📉 **4つのシナリオ**: 軽度（20%減）、中度（30%減）、重度（50%減）、一時的ショック
- 🎯 **限界値の可視化**: 売上が何%減少すると資金ショートするかを明確化

#### Phase 2-2: 取引先倒産シミュレーション
- 💥 **連鎖倒産リスク**: 大口取引先の倒産による売掛金回収不能と売上減少の複合影響
- 📊 **4つの規模別シナリオ**: 小規模（売上10%）〜最大手（売上40%）
- 💰 **売掛金損失の影響**: 回収不能額と継続的売上減少を同時シミュレーション

#### Phase 2-3: 金利上昇シミュレーション
- 📈 **日銀政策変更対応**: 借入金利上昇による月次利払い増加の影響分析
- 💵 **4つの上昇幅**: 0.5%、1.0%、2.0%、3.0%の金利上昇シナリオ
- 🏦 **固定費増加効果**: 金利負担増による資金繰り圧迫を定量評価

#### Phase 2-4: 仕入価格高騰シミュレーション
- 📦 **インフレ対応**: 原材料費・仕入価格上昇による粗利率悪化の影響
- 📉 **4つの高騰幅**: 原価率3%、5%、10%、15%の上昇シナリオ
- 💹 **粗利圧迫効果**: キャッシュフロー減少の定量評価

**共通機能:**
- 🚨 **リスク判定**: 各シナリオを🟢安全・🟡注意・🟠警戒・🔴危険の4段階で自動判定
- 📊 **視覚的比較**: 横棒グラフで複数シナリオを一目で比較

---

## 🖼️ スクリーンショット

### メインダッシュボード（Phase 1）
![資金繰りダッシュボード](images/dashboard_sample.png)

### 感度分析（Phase 1: What-if シミュレーション）
![感度分析](images/sensitivity_sample.png)

### Phase 2 ストレステスト結果

#### Phase 2-1: 売上急落シナリオ
![ストレステスト結果](images/stress_test_sample.png)

#### Phase 2-2: 取引先倒産リスク
![取引先倒産リスク](images/bankruptcy_risk_sample.png)

#### Phase 2-3: 金利上昇リスク
![金利上昇リスク](images/interest_rate_risk_sample.png)

#### Phase 2-4: 仕入価格高騰リスク
![仕入価格高騰リスク](images/cost_inflation_risk_sample.png)

---

## 🚀 クイックスタート

### 必要な環境

- Python 3.8 以上
- Jupyter Notebook（Anaconda推奨）

### インストール

```bash
# リポジトリをクローン
git clone https://github.com/あなたのユーザー名/cashflow-risk-analyzer.git
cd cashflow-risk-analyzer

# 必要なパッケージをインストール
pip install -r requirements.txt

# Jupyter Notebookを起動
jupyter notebook
```

### 使い方

#### Phase 1 + Phase 2 完全版（推奨）

1. `cashflow_simulator_phase2_full.ipynb` を開く
2. **セル3** のパラメータを自社の数字に変更
3. メニューから `Kernel` → `Restart & Run All` を実行
4. **Phase 1のグラフ（2枚）とPhase 2のストレステスト結果（5枚）が自動生成されます**
   - Phase 1: 資金繰りダッシュボード、感度分析
   - Phase 2-1: 売上急落シナリオ
   - Phase 2-2: 取引先倒産リスク
   - Phase 2-3: 金利上昇リスク
   - Phase 2-4: 仕入価格高騰リスク

#### Phase 1のみ

1. `phase1_資金繰りシミュレーター_日本語版.ipynb` を開く
2. **セル3** のパラメータを自社の数字に変更
3. メニューから `Kernel` → `Restart & Run All` を実行
4. グラフが自動生成されます

**パラメータ例（中小製造業）:**

```python
params = CashFlowParameters(
    monthly_sales=1000,           # 月次売上（万円）
    cash_balance=800,             # 現金残高（万円）
    monthly_fixed_cost=320,       # 月次固定費（万円）
    cost_rate=0.60,               # 売上原価率（60%）
    sales_volatility=0.15,        # 売上変動率（15%）
    accounts_receivable_days=30,  # 売掛サイト（日）
)
```

---

## 📊 出力ファイル

実行すると、以下のファイルが自動生成されます：

### Phase 1

- `資金繰りダッシュボード.png` - 4枚組の分析グラフ
  - 現金残高の予測範囲
  - 月次資金ショート確率
  - 最低残高の分布
  - 損益分岐点分析

- `感度分析.png` - シナリオ比較グラフ
  - 固定費削減の効果
  - 売上減少時のリスク
  - 各種改善策の比較

### Phase 2（ストレステスト完全版）

#### Phase 2-1: 売上急落シナリオ
- `ストレステスト結果.png`
  - 4シナリオ（20%減、30%減、50%減、一時的ショック）の比較
  - 資金ショート確率と12ヶ月後残高の横棒グラフ

#### Phase 2-2: 取引先倒産リスク
- `取引先倒産リスク.png`
  - 4規模（小規模〜最大手）の取引先倒産シナリオ比較
  - 売掛金回収不能と売上減少の複合影響

#### Phase 2-3: 金利上昇リスク
- `金利上昇リスク.png`
  - 4つの金利上昇幅（0.5%、1.0%、2.0%、3.0%）の比較
  - 借入金3,000万円を前提とした利払い増加の影響

#### Phase 2-4: 仕入価格高騰リスク
- `仕入価格高騰リスク.png`
  - 4つの原価率上昇幅（3%、5%、10%、15%）の比較
  - 粗利率悪化によるキャッシュフロー影響

**Phase 2共通:**
- すべてリスク判定（🟢安全・🟡注意・🟠警戒・🔴危険）付き
- 横棒グラフで複数シナリオを視覚的に比較

---

## 🎓 技術的な特徴

### モンテカルロ法による確率的シミュレーション

従来の資金繰り表は「単一のシナリオ」しか扱えませんが、このツールは：

- **10,000通りの売上シナリオ**を一度に計算
- 売上の変動を**正規分布**でモデル化（現実的な仮定）
- 資金ショート確率を**統計的に算出**

### 実務経験に基づく設計

- **入力項目は最小限**（5-6項目）: 社長が5分で答えられる
- **完全日本語対応**: 経営者・銀行員向けに最適化
- **業種別パラメータ**: 製造業・飲食業・小売業など

### コードの品質

- **PEP 8準拠**: Pythonコーディング規約に準拠
- **詳細なdocstring**: 各関数に使い方を明記
- **エラーハンドリング**: 入力値の妥当性チェック
- **可視化重視**: matplotlibで見やすいグラフを自動生成

---

## 📁 ファイル構成

```
cashflow-risk-analyzer/
├── cashflow_simulator_phase2_full.ipynb           # Phase 1 + 2 完全版（推奨）
├── phase1_資金繰りシミュレーター_日本語版.ipynb  # Phase 1のみ
├── README.md                                      # このファイル
├── requirements.txt                               # 必要パッケージ
├── LICENSE                                        # MITライセンス
├── images/                                        # サンプル画像
│   ├── dashboard_sample.png                      # Phase 1 ダッシュボード
│   ├── sensitivity_sample.png                    # Phase 1 感度分析
│   ├── stress_test_sample.png                    # Phase 2-1 売上急落
│   ├── bankruptcy_risk_sample.png                # Phase 2-2 取引先倒産
│   ├── interest_rate_risk_sample.png             # Phase 2-3 金利上昇
│   └── cost_inflation_risk_sample.png            # Phase 2-4 仕入価格高騰
└── docs/                                          # ドキュメント
    └── 使い方ガイド.pptx
```

---

## 🔧 業種別パラメータの目安

| 業種 | 原価率 | 変動率 | 売掛サイト |
|------|--------|--------|------------|
| 製造業 | 60-70% | 10-15% | 30-60日 |
| 飲食業 | 65-75% | 20-30% | 0日（現金） |
| 小売業 | 70-80% | 15-20% | 0-30日 |
| サービス業 | 30-50% | 10-15% | 30-45日 |
| 建設業 | 80-85% | 25-35% | 60-90日 |

---

## 🛠️ 今後の開発予定

### ✅ Phase 2: ストレステスト完全版（完了 - 2026年2月）
- ✅ Phase 2-1: 売上急落シミュレーション（4シナリオ）
- ✅ Phase 2-2: 取引先倒産シミュレーション（4シナリオ）
- ✅ Phase 2-3: 金利上昇シミュレーション（4シナリオ）
- ✅ Phase 2-4: 仕入価格高騰シミュレーション（4シナリオ）
- ✅ リスク判定機能（🟢🟡🟠🔴）
- ✅ 完全日本語対応ダッシュボード

### Phase 3: 改善策提案エンジン（予定）
- 回収サイト短縮の効果試算
- 在庫圧縮の効果
- リスケジュール（返済条件変更）の影響

### Phase 4: Excel連携
- openpyxlでExcelから直接データ読込
- 結果をExcelに自動出力

---

## 📖 ドキュメント

- [使い方ガイド（PowerPoint）](docs/使い方ガイド.pptx)
- [技術解説（準備中）](#)
- [よくある質問（準備中）](#)

---

## 🤝 貢献

Issue報告やPull Requestを歓迎します。

### 開発環境のセットアップ

```bash
# リポジトリをクローン
git clone https://github.com/あなたのユーザー名/cashflow-risk-analyzer.git
cd cashflow-risk-analyzer

# 仮想環境を作成（推奨）
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

# 開発用パッケージをインストール
pip install -r requirements.txt
```

---

## 📜 ライセンス

[MIT License](LICENSE) - 商用利用・改変・再配布が自由です。

---

## 👤 開発者

**T社 金融実務経験20年**

- J信用金庫（融資審査）
- T社（企業評価）
- 70万社のデータ分析経験
- 中央官庁の公開報告書（実績証明）

### 連絡先

- GitHub: [@あなたのユーザー名](https://github.com/あなたのユーザー名)
- LinkedIn: [プロフィールURL]（オプション）

---

## 🙏 謝辞

このツールは、20年間の金融実務で見てきた「資金繰り表を作っていない中小企業」が多い現実を踏まえ、
**5分で入力できる最小限の項目**で実用的なリスク分析を可能にすることを目指して開発しました。

モンテカルロ法の実装にあたっては、NumPyの公式ドキュメントと統計学の標準的な手法を参考にしています。

---

## ⭐ Star歓迎

このプロジェクトが役に立ったら、ぜひ⭐をつけてください！

---

**作成日:** 2026年2月  
**バージョン:** Phase 2 完全版（ストレステスト4機能実装）  
**最終更新:** 2026年2月19日
